<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitansh Heights Society Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .auth-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .main-content {
            display: none;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            color: #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: #2c3e50;
            color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            padding: 25px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .dashboard-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .notice-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .notice-date {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .calendar-day {
            background: white;
            padding: 15px 5px;
            text-align: center;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
        }

        .calendar-day:hover {
            background: #f0f0f0;
        }

        .calendar-day.booked {
            background: #ff6b6b;
            color: white;
        }

        .calendar-day.available {
            background: #00b894;
            color: white;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .file-upload.dragover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .user-type {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .user-type input[type="radio"] {
            display: none;
        }

        .user-type label {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type input[type="radio"]:checked + label {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #f8d7da;
            color: #721c24;
        }

        .status-approved {
            background: #d1ecf1;
            color: #0c5460;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .floating-action:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .table {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Hitansh Heights Society</h1>
            <p>Complete Society Management System</p>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <h2>Welcome to Hitansh Heights</h2>
            <div class="login-form">
                <div class="user-type">
                    <input type="radio" id="admin" name="userType" value="admin" checked>
                    <label for="admin">Admin</label>
                    <input type="radio" id="resident" name="userType" value="resident">
                    <label for="resident">Resident</label>
                </div>
                <div class="form-group">
                    <label>Username/Flat Number</label>
                    <input type="text" id="username" placeholder="Enter username or flat number">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Enter password">
                </div>
                <button class="btn" onclick="login()">Login</button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showTab('members')">Members</button>
                <button class="nav-tab" onclick="showTab('maintenance')">Maintenance</button>
                <button class="nav-tab" onclick="showTab('expenses')">Expenses</button>
                <button class="nav-tab" onclick="showTab('fines')">Fines</button>
                <button class="nav-tab" onclick="showTab('clubhouse')">Clubhouse</button>
                <button class="nav-tab" onclick="showTab('parking')">Parking</button>
                <button class="nav-tab" onclick="showTab('complaints')">Complaints</button>
                <button class="nav-tab" onclick="showTab('documents')">Documents</button>
                <button class="nav-tab" onclick="showTab('reports')">Reports</button>
                <button class="nav-tab" onclick="logout()">Logout</button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard Overview</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Maintenance Paid</h3>
                        <div class="value" id="paidCount">0</div>
                        <p>Residents</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Maintenance Pending</h3>
                        <div class="value" id="pendingCount">0</div>
                        <p>Residents</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Total Expenses</h3>
                        <div class="value" id="totalExpenses">‚Çπ0</div>
                        <p>This Month</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Active Notices</h3>
                        <div class="value" id="noticeCount">0</div>
                        <p>Notices</p>
                    </div>
                </div>

                <h3>Recent Notices</h3>
                <div id="recentNotices"></div>

                <h3>Quick Actions</h3>
                <button class="btn" onclick="showModal('addNoticeModal')">Add Notice</button>
                <button class="btn" onclick="showModal('addExpenseModal')">Add Expense</button>
                <button class="btn" onclick="calculateMaintenance()">Calculate Maintenance</button>
            </div>

            <!-- Members Tab -->
            <div id="members" class="tab-content">
                <h2>Society Members</h2>
                <button class="btn" onclick="showModal('addMemberModal')">Add Member</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Flat No.</th>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Area (sq.ft)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTable"></tbody>
                </table>
            </div>

            <!-- Maintenance Tab -->
            <div id="maintenance" class="tab-content">
                <h2>Maintenance Management</h2>
                <div class="form-group">
                    <label>Total Monthly Expenses (‚Çπ)</label>
                    <input type="number" id="monthlyExpenses" placeholder="Enter total expenses">
                </div>
                <div class="form-group">
                    <label>Monthly Savings (‚Çπ)</label>
                    <input type="number" id="monthlySavings" placeholder="Enter savings amount">
                </div>
                <button class="btn" onclick="calculateMaintenance()">Calculate Maintenance</button>
                
                <div id="maintenanceResults" style="margin-top: 20px;"></div>
                
                <h3>Payment Status</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Flat No.</th>
                            <th>Name</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceTable"></tbody>
                </table>
            </div>

            <!-- Expenses Tab -->
            <div id="expenses" class="tab-content">
                <h2>Society Expenses</h2>
                <button class="btn" onclick="showModal('addExpenseModal')">Add Expense</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Bill</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable"></tbody>
                </table>
            </div>

            <!-- Other tabs continue... -->
            <div id="fines" class="tab-content">
                <h2>Fines Management</h2>
                <button class="btn" onclick="showModal('addFineModal')">Add Fine</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Flat No.</th>
                            <th>Reason</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="finesTable"></tbody>
                </table>
            </div>

            <div id="clubhouse" class="tab-content">
                <h2>Clubhouse Booking</h2>
                <button class="btn" onclick="showModal('bookClubhouseModal')">Book Clubhouse</button>
                <div class="calendar" id="clubhouseCalendar"></div>
                <h3>Booking Requests</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Flat No.</th>
                            <th>Purpose</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="clubhouseTable"></tbody>
                </table>
            </div>

            <div id="parking" class="tab-content">
                <h2>Parking Management</h2>
                <button class="btn" onclick="showModal('addVehicleModal')">Add Vehicle</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Flat No.</th>
                            <th>Vehicle Type</th>
                            <th>Vehicle Number</th>
                            <th>Monthly Charge</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="parkingTable"></tbody>
                </table>
            </div>

            <div id="complaints" class="tab-content">
                <h2>Complaints & Suggestions</h2>
                <button class="btn" onclick="showModal('addComplaintModal')">Add Complaint</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Flat No.</th>
                            <th>Type</th>
                            <th>Subject</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="complaintsTable"></tbody>
                </table>
            </div>

            <div id="documents" class="tab-content">
                <h2>Document Library</h2>
                <button class="btn" onclick="showModal('uploadDocumentModal')">Upload Document</button>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Document Name</th>
                            <th>Category</th>
                            <th>Upload Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="documentsTable"></tbody>
                </table>
            </div>

            <div id="reports" class="tab-content">
                <h2>Reports</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Maintenance Report</h3>
                        <button class="btn" onclick="generateReport('maintenance')">Generate</button>
                    </div>
                    <div class="dashboard-card">
                        <h3>Expense Report</h3>
                        <button class="btn" onclick="generateReport('expenses')">Generate</button>
                    </div>
                    <div class="dashboard-card">
                        <h3>Fine Report</h3>
                        <button class="btn" onclick="generateReport('fines')">Generate</button>
                    </div>
                    <div class="dashboard-card">
                        <h3>Clubhouse Report</h3>
                        <button class="btn" onclick="generateReport('clubhouse')">Generate</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Member Modal -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addMemberModal')">&times;</span>
            <h2>Add Society Member</h2>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="memberName" placeholder="Enter full name">
            </div>
            <div class="form-group">
                <label>Flat Number</label>
                <input type="text" id="flatNumber" placeholder="Enter flat number">
            </div>
            <div class="form-group">
                <label>Contact Number</label>
                <input type="tel" id="contactNumber" placeholder="Enter contact number">
            </div>
            <div class="form-group">
                <label>Area (sq.ft)</label>
                <input type="number" id="flatArea" placeholder="Enter area in sq.ft">
            </div>
            <button class="btn" onclick="addMember()">Add Member</button>
        </div>
    </div>

    <!-- Add Notice Modal -->
    <div id="addNoticeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addNoticeModal')">&times;</span>
            <h2>Add Notice</h2>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="noticeTitle" placeholder="Enter notice title">
            </div>
            <div class="form-group">
                <label>Content</label>
                <textarea id="noticeContent" rows="5" placeholder="Enter notice content"></textarea>
            </div>
            <div class="form-group">
                <label>Priority</label>
                <select id="noticePriority">
                    <option value="normal">Normal</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                </select>
            </div>
            <button class="btn" onclick="addNotice()">Add Notice</button>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addExpenseModal')">&times;</span>
            <h2>Add Expense</h2>
            <div class="form-group">
                <label>Category</label>
                <select id="expenseCategory">
                    <option value="maintenance">Maintenance</option>
                    <option value="security">Security</option>
                    <option value="cleaning">Cleaning</option>
                    <option value="utilities">Utilities</option>
                    <option value="repairs">Repairs</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" id="expenseDescription" placeholder="Enter description">
            </div>
            <div class="form-group">
                <label>Amount (‚Çπ)</label>
                <input type="number" id="expenseAmount" placeholder="Enter amount">
            </div>
            <div class="form-group">
                <label>Bill/Receipt</label>
                <div class="file-upload" onclick="document.getElementById('billFile').click()">
                    <p>Click to upload bill/receipt</p>
                    <input type="file" id="billFile" style="display: none;" accept=".pdf,.jpg,.jpeg,.png">
                </div>
            </div>
            <button class="btn" onclick="addExpense()">Add Expense</button>
        </div>
    </div>

    <!-- Additional modals for other features... -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Global Data Storage (In real implementation, this would be in JSON files)
        let societyData = {
            members: [
                {id: 1, name: "Rajesh Kumar", flat: "A-101", contact: "9876543210", area: 1200, maintenancePaid: true},
                {id: 2, name: "Priya Sharma", flat: "A-102", contact: "9876543211", area: 1000, maintenancePaid: false},
                {id: 3, name: "Amit Patel", flat: "B-201", contact: "9876543212", area: 1100, maintenancePaid: true}
            ],
            expenses: [
                {id: 1, date: "2024-01-15", category: "maintenance", description: "Elevator Repair", amount: 15000, bill: "elevator_bill.pdf"},
                {id: 2, date: "2024-01-10", category: "security", description: "Security Guard Salary", amount: 25000, bill: null}
            ],
            notices: [
                {id: 1, title: "Water Tank Cleaning", content: "Water tank cleaning scheduled for this weekend", date: "2024-01-20", priority: "high"},
                {id: 2, title: "Parking Rules", content: "Please follow parking guidelines", date: "2024-01-18", priority: "normal"}
            ],
            fines: [],
            clubhouseBookings: [],
            vehicles: [],
            complaints: [],
            documents: [],
            maintenanceRate: 0,
            monthlyExpenses: 0,
            monthlySavings: 0
        };

        let currentUser = null;
        let currentUserType = null;

        // Authentication
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.querySelector('input[name="userType"]:checked').value;

            // Simple authentication (in real app, this would be more secure)
            if (userType === 'admin' && username === 'admin' && password === 'admin123') {
                currentUser = 'admin';
                currentUserType = 'admin';
                showMainContent();
            } else if (userType === 'resident') {
                // Check if flat number exists
                const member = societyData.members.find(m => m.flat === username);
                if (member && password === 'resident123') {
                    currentUser = member;
                    currentUserType = 'resident';
                    showMainContent();
                    restrictResidentAccess();
                } else {
                    alert('Invalid credentials');
                }
            } else {
                alert('Invalid credentials');
            }
        }

        function logout() {
            currentUser = null;
            currentUserType = null;
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showMainContent() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            loadDashboard();
            loadMembers();
            loadExpenses();
            loadNotices();
        }

        function restrictResidentAccess() {
            const restrictedTabs = ['members', 'expenses', 'fines', 'parking', 'documents'];
            restrictedTabs.forEach(tab => {
                const tabButton = document.querySelector(`[onclick="showTab('${tab}')"]`);
                if (tabButton) {
                    tabButton.style.display = 'none';
                }
            });
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
            
            // Load tab-specific content
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'members':
                    loadMembers();
                    break;
                case 'maintenance':
                    loadMaintenance();
                    break;
                case 'expenses':
                    loadExpenses();
                    break;
                case 'fines':
                    loadFines();
                    break;
                case 'clubhouse':
                    loadClubhouse();
                    break;
                case 'parking':
                    loadParking();
                    break;
                case 'complaints':
                    loadComplaints();
                    break;
                case 'documents':
                    loadDocuments();
                    break;
            }
        }

        // Modal Management
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Clear form fields
            const modal = document.getElementById(modalId);
            const inputs = modal.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.value = '';
            });
        }

        // Dashboard Functions
        function loadDashboard() {
            const paidCount = societyData.members.filter(m => m.maintenancePaid).length;
            const pendingCount = societyData.members.filter(m => !m.maintenancePaid).length;
            const totalExpenses = societyData.expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const noticeCount = societyData.notices.length;

            document.getElementById('paidCount').textContent = paidCount;
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('totalExpenses').textContent = `‚Çπ${totalExpenses.toLocaleString()}`;
            document.getElementById('noticeCount').textContent = noticeCount;

            // Load recent notices
            const recentNoticesDiv = document.getElementById('recentNotices');
            recentNoticesDiv.innerHTML = '';
            
            societyData.notices.slice(0, 3).forEach(notice => {
                const noticeDiv = document.createElement('div');
                noticeDiv.className = 'notice-item';
                noticeDiv.innerHTML = `
                    <div class="notice-date">${notice.date}</div>
                    <h4>${notice.title}</h4>
                    <p>${notice.content}</p>
                    <span class="status-badge status-${notice.priority}">${notice.priority}</span>
                `;
                recentNoticesDiv.appendChild(noticeDiv);
            });
        }

        // Member Management
        function loadMembers() {
            const membersTable = document.getElementById('membersTable');
            membersTable.innerHTML = '';
            
            societyData.members.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.flat}</td>
                    <td>${member.name}</td>
                    <td>${member.contact}</td>
                    <td>${member.area}</td>
                    <td>
                        <button class="btn" onclick="editMember(${member.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteMember(${member.id})">Delete</button>
                    </td>
                `;
                membersTable.appendChild(row);
            });
        }

        function addMember() {
            const name = document.getElementById('memberName').value;
            const flat = document.getElementById('flatNumber').value;
            const contact = document.getElementById('contactNumber').value;
            const area = parseInt(document.getElementById('flatArea').value);

            if (!name || !flat || !contact || !area) {
                alert('Please fill all fields');
                return;
            }

            const newMember = {
                id: Date.now(),
                name: name,
                flat: flat,
                contact: contact,
                area: area,
                maintenancePaid: false
            };

            societyData.members.push(newMember);
            loadMembers();
            loadDashboard();
            closeModal('addMemberModal');
            alert('Member added successfully!');
        }

        function deleteMember(id) {
            if (confirm('Are you sure you want to delete this member?')) {
                societyData.members = societyData.members.filter(m => m.id !== id);
                loadMembers();
                loadDashboard();
            }
        }

        // Maintenance Management
        function loadMaintenance() {
            const maintenanceTable = document.getElementById('maintenanceTable');
            maintenanceTable.innerHTML = '';
            
            societyData.members.forEach(member => {
                const maintenanceAmount = Math.round(societyData.maintenanceRate * member.area);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.flat}</td>
                    <td>${member.name}</td>
                    <td>‚Çπ${maintenanceAmount}</td>
                    <td><span class="status-badge ${member.maintenancePaid ? 'status-paid' : 'status-pending'}">
                        ${member.maintenancePaid ? 'Paid' : 'Pending'}</span></td>
                    <td>
                        <button class="btn ${member.maintenancePaid ? 'btn-danger' : 'btn-success'}" 
                                onclick="toggleMaintenanceStatus(${member.id})">
                            ${member.maintenancePaid ? 'Mark Unpaid' : 'Mark Paid'}
                        </button>
                    </td>
                `;
                maintenanceTable.appendChild(row);
            });
        }

        function calculateMaintenance() {
            const expenses = parseFloat(document.getElementById('monthlyExpenses').value) || societyData.monthlyExpenses;
            const savings = parseFloat(document.getElementById('monthlySavings').value) || societyData.monthlySavings;
            
            if (!expenses) {
                alert('Please enter monthly expenses');
                return;
            }

            const totalMaintenance = expenses + savings;
            const totalArea = societyData.members.reduce((sum, member) => sum + member.area, 0);
            const maintenanceRate = totalMaintenance / totalArea;

            societyData.monthlyExpenses = expenses;
            societyData.monthlySavings = savings;
            societyData.maintenanceRate = maintenanceRate;

            const resultsDiv = document.getElementById('maintenanceResults');
            resultsDiv.innerHTML = `
                <div class="dashboard-card">
                    <h3>Maintenance Calculation Results</h3>
                    <p><strong>Total Expenses:</strong> ‚Çπ${expenses.toLocaleString()}</p>
                    <p><strong>Monthly Savings:</strong> ‚Çπ${savings.toLocaleString()}</p>
                    <p><strong>Total Maintenance Needed:</strong> ‚Çπ${totalMaintenance.toLocaleString()}</p>
                    <p><strong>Total Society Area:</strong> ${totalArea.toLocaleString()} sq.ft</p>
                    <p><strong>Rate per sq.ft:</strong> ‚Çπ${maintenanceRate.toFixed(2)}</p>
                </div>
            `;

            loadMaintenance();
        }

        function toggleMaintenanceStatus(memberId) {
            const member = societyData.members.find(m => m.id === memberId);
            if (member) {
                member.maintenancePaid = !member.maintenancePaid;
                loadMaintenance();
                loadDashboard();
            }
        }

        // Expense Management
        function loadExpenses() {
            const expensesTable = document.getElementById('expensesTable');
            expensesTable.innerHTML = '';
            
            societyData.expenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.date}</td>
                    <td>${expense.category}</td>
                    <td>${expense.description}</td>
                    <td>‚Çπ${expense.amount.toLocaleString()}</td>
                    <td>${expense.bill ? `<a href="#" onclick="viewBill('${expense.bill}')">View Bill</a>` : 'No Bill'}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteExpense(${expense.id})">Delete</button>
                    </td>
                `;
                expensesTable.appendChild(row);
            });
        }

        function addExpense() {
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const billFile = document.getElementById('billFile').files[0];

            if (!category || !description || !amount) {
                alert('Please fill all required fields');
                return;
            }

            const newExpense = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                category: category,
                description: description,
                amount: amount,
                bill: billFile ? billFile.name : null
            };

            societyData.expenses.push(newExpense);
            loadExpenses();
            loadDashboard();
            closeModal('addExpenseModal');
            alert('Expense added successfully!');
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                societyData.expenses = societyData.expenses.filter(e => e.id !== id);
                loadExpenses();
                loadDashboard();
            }
        }

        // Notice Management
        function loadNotices() {
            // This is called from loadDashboard for recent notices
        }

        function addNotice() {
            const title = document.getElementById('noticeTitle').value;
            const content = document.getElementById('noticeContent').value;
            const priority = document.getElementById('noticePriority').value;

            if (!title || !content) {
                alert('Please fill all fields');
                return;
            }

            const newNotice = {
                id: Date.now(),
                title: title,
                content: content,
                date: new Date().toISOString().split('T')[0],
                priority: priority
            };

            societyData.notices.unshift(newNotice);
            loadDashboard();
            closeModal('addNoticeModal');
            alert('Notice added successfully!');
        }

        // Fines Management
        function loadFines() {
            const finesTable = document.getElementById('finesTable');
            finesTable.innerHTML = '';
            
            societyData.fines.forEach(fine => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${fine.flat}</td>
                    <td>${fine.reason}</td>
                    <td>‚Çπ${fine.amount}</td>
                    <td>${fine.date}</td>
                    <td><span class="status-badge ${fine.paid ? 'status-paid' : 'status-pending'}">
                        ${fine.paid ? 'Paid' : 'Pending'}</span></td>
                    <td>
                        <button class="btn ${fine.paid ? 'btn-danger' : 'btn-success'}" 
                                onclick="toggleFineStatus(${fine.id})">
                            ${fine.paid ? 'Mark Unpaid' : 'Mark Paid'}
                        </button>
                        <button class="btn btn-danger" onclick="deleteFine(${fine.id})">Delete</button>
                    </td>
                `;
                finesTable.appendChild(row);
            });
        }

        function toggleFineStatus(fineId) {
            const fine = societyData.fines.find(f => f.id === fineId);
            if (fine) {
                fine.paid = !fine.paid;
                loadFines();
            }
        }

        function deleteFine(id) {
            if (confirm('Are you sure you want to delete this fine?')) {
                societyData.fines = societyData.fines.filter(f => f.id !== id);
                loadFines();
            }
        }

        // Clubhouse Management
        function loadClubhouse() {
            generateCalendar();
            const clubhouseTable = document.getElementById('clubhouseTable');
            clubhouseTable.innerHTML = '';
            
            societyData.clubhouseBookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${booking.date}</td>
                    <td>${booking.time}</td>
                    <td>${booking.flat}</td>
                    <td>${booking.purpose}</td>
                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                    <td>
                        ${currentUserType === 'admin' ? `
                            <button class="btn btn-success" onclick="approveBooking(${booking.id})">Approve</button>
                            <button class="btn btn-danger" onclick="rejectBooking(${booking.id})">Reject</button>
                        ` : ''}
                    </td>
                `;
                clubhouseTable.appendChild(row);
            });
        }

        function generateCalendar() {
            const calendar = document.getElementById('clubhouseCalendar');
            calendar.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day';
                dayHeader.innerHTML = `<strong>${day}</strong>`;
                dayHeader.style.backgroundColor = '#f0f0f0';
                calendar.appendChild(dayHeader);
            });
            
            // Add calendar days (simplified - showing current month)
            const today = new Date();
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            
            for (let i = 1; i <= daysInMonth; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                const isBooked = societyData.clubhouseBookings.some(b => b.date === dateStr && b.status === 'approved');
                
                dayDiv.innerHTML = `<div>${i}</div>`;
                dayDiv.className += isBooked ? ' booked' : ' available';
                
                if (!isBooked) {
                    dayDiv.onclick = () => selectDate(dateStr);
                }
                
                calendar.appendChild(dayDiv);
            }
        }

        function selectDate(date) {
            // This would open booking modal with pre-selected date
            showModal('bookClubhouseModal');
        }

        // Parking Management
        function loadParking() {
            const parkingTable = document.getElementById('parkingTable');
            parkingTable.innerHTML = '';
            
            societyData.vehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.flat}</td>
                    <td>${vehicle.type}</td>
                    <td>${vehicle.number}</td>
                    <td>‚Çπ${vehicle.monthlyCharge}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteVehicle(${vehicle.id})">Delete</button>
                    </td>
                `;
                parkingTable.appendChild(row);
            });
        }

        function deleteVehicle(id) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                societyData.vehicles = societyData.vehicles.filter(v => v.id !== id);
                loadParking();
            }
        }

        // Complaints Management
        function loadComplaints() {
            const complaintsTable = document.getElementById('complaintsTable');
            complaintsTable.innerHTML = '';
            
            societyData.complaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${complaint.date}</td>
                    <td>${complaint.flat}</td>
                    <td>${complaint.type}</td>
                    <td>${complaint.subject}</td>
                    <td><span class="status-badge status-${complaint.status}">${complaint.status}</span></td>
                    <td>
                        <button class="btn" onclick="viewComplaint(${complaint.id})">View</button>
                        ${currentUserType === 'admin' ? `
                            <button class="btn btn-success" onclick="resolveComplaint(${complaint.id})">Resolve</button>
                        ` : ''}
                    </td>
                `;
                complaintsTable.appendChild(row);
            });
        }

        function resolveComplaint(id) {
            const complaint = societyData.complaints.find(c => c.id === id);
            if (complaint) {
                complaint.status = 'resolved';
                loadComplaints();
            }
        }

        // Documents Management
        function loadDocuments() {
            const documentsTable = document.getElementById('documentsTable');
            documentsTable.innerHTML = '';
            
            societyData.documents.forEach(doc => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doc.name}</td>
                    <td>${doc.category}</td>
                    <td>${doc.uploadDate}</td>
                    <td>
                        <button class="btn" onclick="downloadDocument('${doc.name}')">Download</button>
                        ${currentUserType === 'admin' ? `
                            <button class="btn btn-danger" onclick="deleteDocument(${doc.id})">Delete</button>
                        ` : ''}
                    </td>
                `;
                documentsTable.appendChild(row);
            });
        }

        function deleteDocument(id) {
            if (confirm('Are you sure you want to delete this document?')) {
                societyData.documents = societyData.documents.filter(d => d.id !== id);
                loadDocuments();
            }
        }

        // Report Generation
        function generateReport(type) {
            let reportData = [];
            let filename = '';
            
            switch(type) {
                case 'maintenance':
                    reportData = societyData.members.map(member => ({
                        'Flat No': member.flat,
                        'Name': member.name,
                        'Area (sq.ft)': member.area,
                        'Maintenance Amount': Math.round(societyData.maintenanceRate * member.area),
                        'Status': member.maintenancePaid ? 'Paid' : 'Pending'
                    }));
                    filename = 'maintenance_report.xlsx';
                    break;
                    
                case 'expenses':
                    reportData = societyData.expenses.map(expense => ({
                        'Date': expense.date,
                        'Category': expense.category,
                        'Description': expense.description,
                        'Amount': expense.amount,
                        'Bill': expense.bill || 'No Bill'
                    }));
                    filename = 'expense_report.xlsx';
                    break;
                    
                case 'fines':
                    reportData = societyData.fines.map(fine => ({
                        'Flat No': fine.flat,
                        'Reason': fine.reason,
                        'Amount': fine.amount,
                        'Date': fine.date,
                        'Status': fine.paid ? 'Paid' : 'Pending'
                    }));
                    filename = 'fine_report.xlsx';
                    break;
                    
                case 'clubhouse':
                    reportData = societyData.clubhouseBookings.map(booking => ({
                        'Date': booking.date,
                        'Time': booking.time,
                        'Flat No': booking.flat,
                        'Purpose': booking.purpose,
                        'Status': booking.status
                    }));
                    filename = 'clubhouse_report.xlsx';
                    break;
            }
            
            if (reportData.length === 0) {
                alert('No data available for this report');
                return;
            }
            
            // Generate Excel file
            const ws = XLSX.utils.json_to_sheet(reportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Report');
            XLSX.writeFile(wb, filename);
        }

        // Utility Functions
        function viewBill(billName) {
            alert(`Viewing bill: ${billName}\n\nNote: In a real implementation, this would open the actual bill file stored in your GitHub repository.`);
        }

        function downloadDocument(docName) {
            alert(`Downloading: ${docName}\n\nNote: In a real implementation, this would download the actual document from your GitHub repository.`);
        }

        function viewComplaint(id) {
            const complaint = societyData.complaints.find(c => c.id === id);
            if (complaint) {
                alert(`Complaint Details:\n\nSubject: ${complaint.subject}\nDescription: ${complaint.description}\nStatus: ${complaint.status}`);
            }
        }

        // Initialize the application
        window.onload = function() {
            // Close modals when clicking outside
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            }
            
            // File upload handling
            document.getElementById('billFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const fileUpload = document.querySelector('.file-upload');
                    fileUpload.innerHTML = `<p>Selected: ${file.name}</p>`;
                }
            });
        };

        // Sample data for testing (remove in production)
        function addSampleData() {
            // Add sample fines
            societyData.fines.push(
                {id: 1, flat: "A-101", reason: "Parking violation", amount: 500, date: "2024-01-15", paid: false},
                {id: 2, flat: "B-201", reason: "Noise complaint", amount: 1000, date: "2024-01-10", paid: true}
            );
            
            // Add sample clubhouse bookings
            societyData.clubhouseBookings.push(
                {id: 1, date: "2024-02-15", time: "18:00-22:00", flat: "A-102", purpose: "Birthday Party", status: "approved"},
                {id: 2, date: "2024-02-20", time: "10:00-14:00", flat: "B-201", purpose: "Family Function", status: "pending"}
            );
            
            // Add sample vehicles
            societyData.vehicles.push(
                {id: 1, flat: "A-101", type: "Car", number: "MH12AB1234", monthlyCharge: 1000},
                {id: 2, flat: "A-101", type: "Bike", number: "MH12CD5678", monthlyCharge: 500},
                {id: 3, flat: "A-102", type: "Car", number: "MH12EF9012", monthlyCharge: 1000}
            );
            
            // Add sample complaints
            societyData.complaints.push(
                {id: 1, date: "2024-01-18", flat: "A-102", type: "Maintenance", subject: "Water leakage", description: "Water leaking from ceiling", status: "pending"},
                {id: 2, date: "2024-01-15", flat: "B-201", type: "Security", subject: "Gate not working", description: "Main gate lock is broken", status: "resolved"}
            );
            
            // Add sample documents
            societyData.documents.push(
                {id: 1, name: "Society Bylaws", category: "Legal", uploadDate: "2024-01-01"},
                {id: 2, name: "AGM Minutes 2024", category: "Meeting", uploadDate: "2024-01-05"},
                {id: 3, name: "Parking Rules", category: "Policy", uploadDate: "2024-01-10"}
            );
        }
        
        // Add sample data on load
        addSampleData();
    </script>

    <!-- Additional Modals -->
    <!-- Add Fine Modal -->
    <div id="addFineModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addFineModal')">&times;</span>
            <h2>Add Fine</h2>
            <div class="form-group">
                <label>Flat Number</label>
                <select id="fineFlat">
                    <option value="">Select Flat</option>
                </select>
            </div>
            <div class="form-group">
                <label>Reason</label>
                <input type="text" id="fineReason" placeholder="Enter reason for fine">
            </div>
            <div class="form-group">
                <label>Amount (‚Çπ)</label>
                <input type="number" id="fineAmount" placeholder="Enter fine amount">
            </div>
            <button class="btn" onclick="addFine()">Add Fine</button>
        </div>
    </div>

    <!-- Book Clubhouse Modal -->
    <div id="bookClubhouseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bookClubhouseModal')">&times;</span>
            <h2>Book Clubhouse</h2>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="bookingDate">
            </div>
            <div class="form-group">
                <label>Time Slot</label>
                <select id="bookingTime">
                    <option value="10:00-14:00">10:00 AM - 2:00 PM</option>
                    <option value="14:00-18:00">2:00 PM - 6:00 PM</option>
                    <option value="18:00-22:00">6:00 PM - 10:00 PM</option>
                </select>
            </div>
            <div class="form-group">
                <label>Flat Number</label>
                <input type="text" id="bookingFlat" placeholder="Enter flat number">
            </div>
            <div class="form-group">
                <label>Purpose</label>
                <input type="text" id="bookingPurpose" placeholder="Enter purpose of booking">
            </div>
            <button class="btn" onclick="bookClubhouse()">Submit Request</button>
        </div>
    </div>

    <!-- Add Vehicle Modal -->
    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addVehicleModal')">&times;</span>
            <h2>Add Vehicle</h2>
            <div class="form-group">
                <label>Flat Number</label>
                <select id="vehicleFlat">
                    <option value="">Select Flat</option>
                </select>
            </div>
            <div class="form-group">
                <label>Vehicle Type</label>
                <select id="vehicleType">
                    <option value="Car">Car</option>
                    <option value="Bike">Bike</option>
                    <option value="Scooter">Scooter</option>
                </select>
            </div>
            <div class="form-group">
                <label>Vehicle Number</label>
                <input type="text" id="vehicleNumber" placeholder="Enter vehicle number">
            </div>
            <div class="form-group">
                <label>Monthly Charge (‚Çπ)</label>
                <input type="number" id="vehicleCharge" placeholder="Enter monthly parking charge">
            </div>
            <button class="btn" onclick="addVehicle()">Add Vehicle</button>
        </div>
    </div>

    <!-- Add Complaint Modal -->
    <div id="addComplaintModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addComplaintModal')">&times;</span>
            <h2>Add Complaint/Suggestion</h2>
            <div class="form-group">
                <label>Type</label>
                <select id="complaintType">
                    <option value="Complaint">Complaint</option>
                    <option value="Suggestion">Suggestion</option>
                </select>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="complaintCategory">
                    <option value="Maintenance">Maintenance</option>
                    <option value="Security">Security</option>
                    <option value="Cleanliness">Cleanliness</option>
                    <option value="Parking">Parking</option>
                    <option value="Noise">Noise</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Flat Number</label>
                <input type="text" id="complaintFlat" placeholder="Enter flat number">
            </div>
            <div class="form-group">
                <label>Subject</label>
                <input type="text" id="complaintSubject" placeholder="Enter subject">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="complaintDescription" rows="4" placeholder="Enter detailed description"></textarea>
            </div>
            <button class="btn" onclick="addComplaint()">Submit</button>
        </div>
    </div>

    <!-- Upload Document Modal -->
    <div id="uploadDocumentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('uploadDocumentModal')">&times;</span>
            <h2>Upload Document</h2>
            <div class="form-group">
                <label>Document Name</label>
                <input type="text" id="docName" placeholder="Enter document name">
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="docCategory">
                    <option value="Legal">Legal</option>
                    <option value="Policy">Policy</option>
                    <option value="Meeting">Meeting</option>
                    <option value="Financial">Financial</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Document File</label>
                <div class="file-upload" onclick="document.getElementById('docFile').click()">
                    <p>Click to upload document</p>
                    <input type="file" id="docFile" style="display: none;" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                </div>
            </div>
            <button class="btn" onclick="uploadDocument()">Upload Document</button>
        </div>
    </div>

    <script>
        // Additional Functions for Modals

        function addFine() {
            const flat = document.getElementById('fineFlat').value;
            const reason = document.getElementById('fineReason').value;
            const amount = parseFloat(document.getElementById('fineAmount').value);

            if (!flat || !reason || !amount) {
                alert('Please fill all fields');
                return;
            }

            const newFine = {
                id: Date.now(),
                flat: flat,
                reason: reason,
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                paid: false
            };

            societyData.fines.push(newFine);
            loadFines();
            closeModal('addFineModal');
            alert('Fine added successfully!');
        }

        function bookClubhouse() {
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const flat = document.getElementById('bookingFlat').value;
            const purpose = document.getElementById('bookingPurpose').value;

            if (!date || !time || !flat || !purpose) {
                alert('Please fill all fields');
                return;
            }

            // Check if date is already booked
            const existingBooking = societyData.clubhouseBookings.find(
                b => b.date === date && b.time === time && b.status === 'approved'
            );

            if (existingBooking) {
                alert('This time slot is already booked!');
                return;
            }

            const newBooking = {
                id: Date.now(),
                date: date,
                time: time,
                flat: flat,
                purpose: purpose,
                status: 'pending'
            };

            societyData.clubhouseBookings.push(newBooking);
            loadClubhouse();
            closeModal('bookClubhouseModal');
            alert('Booking request submitted successfully!');
        }

        function approveBooking(id) {
            const booking = societyData.clubhouseBookings.find(b => b.id === id);
            if (booking) {
                booking.status = 'approved';
                loadClubhouse();
                alert('Booking approved!');
            }
        }

        function rejectBooking(id) {
            const booking = societyData.clubhouseBookings.find(b => b.id === id);
            if (booking) {
                booking.status = 'rejected';
                loadClubhouse();
                alert('Booking rejected!');
            }
        }

        function addVehicle() {
            const flat = document.getElementById('vehicleFlat').value;
            const type = document.getElementById('vehicleType').value;
            const number = document.getElementById('vehicleNumber').value;
            const charge = parseFloat(document.getElementById('vehicleCharge').value);

            if (!flat || !type || !number || !charge) {
                alert('Please fill all fields');
                return;
            }

            const newVehicle = {
                id: Date.now(),
                flat: flat,
                type: type,
                number: number.toUpperCase(),
                monthlyCharge: charge
            };

            societyData.vehicles.push(newVehicle);
            loadParking();
            closeModal('addVehicleModal');
            alert('Vehicle added successfully!');
        }

        function addComplaint() {
            const type = document.getElementById('complaintType').value;
            const category = document.getElementById('complaintCategory').value;
            const flat = document.getElementById('complaintFlat').value;
            const subject = document.getElementById('complaintSubject').value;
            const description = document.getElementById('complaintDescription').value;

            if (!type || !category || !flat || !subject || !description) {
                alert('Please fill all fields');
                return;
            }

            const newComplaint = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                type: type,
                category: category,
                flat: flat,
                subject: subject,
                description: description,
                status: 'pending'
            };

            societyData.complaints.push(newComplaint);
            loadComplaints();
            closeModal('addComplaintModal');
            alert('Complaint/Suggestion submitted successfully!');
        }

        function uploadDocument() {
            const name = document.getElementById('docName').value;
            const category = document.getElementById('docCategory').value;
            const file = document.getElementById('docFile').files[0];

            if (!name || !category || !file) {
                alert('Please fill all fields and select a file');
                return;
            }

            const newDocument = {
                id: Date.now(),
                name: name,
                category: category,
                uploadDate: new Date().toISOString().split('T')[0],
                fileName: file.name,
                fileSize: file.size
            };

            societyData.documents.push(newDocument);
            loadDocuments();
            closeModal('uploadDocumentModal');
            alert('Document uploaded successfully!');
        }

        // Populate dropdown options when modals are opened
        function populateDropdowns() {
            // Populate flat numbers in dropdowns
            const flatDropdowns = ['fineFlat', 'vehicleFlat'];
            flatDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                dropdown.innerHTML = '<option value="">Select Flat</option>';
                societyData.members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.flat;
                    option.textContent = `${member.flat} - ${member.name}`;
                    dropdown.appendChild(option);
                });
            });
        }

        // Call populateDropdowns when showing modals
        const originalShowModal = showModal;
        showModal = function(modalId) {
            populateDropdowns();
            originalShowModal(modalId);
        };

        // Enhanced file upload handling with drag and drop
        function setupFileUpload() {
            const fileUploads = document.querySelectorAll('.file-upload');
            
            fileUploads.forEach(upload => {
                upload.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                upload.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                upload.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = this.nextElementSibling || this.querySelector('input[type="file"]');
                        if (fileInput) {
                            fileInput.files = files;
                            this.innerHTML = `<p>Selected: ${files[0].name}</p>`;
                        }
                    }
                });
            });
        }

        // Initialize file upload functionality
        window.addEventListener('load', function() {
            setupFileUpload();
            
            // Set up file change handlers
            document.getElementById('docFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const fileUpload = document.querySelector('#uploadDocumentModal .file-upload');
                    fileUpload.innerHTML = `<p>Selected: ${file.name}</p>`;
                }
            });
        });

        // Data persistence functions (for GitHub Pages deployment)
        function saveData() {
            // In a real GitHub Pages deployment, you would:
            // 1. Convert societyData to JSON
            // 2. Use GitHub API to commit changes to data files
            // 3. Or use GitHub Actions to periodically backup data
            
            const dataString = JSON.stringify(societyData, null, 2);
            console.log('Data to be saved:', dataString);
            
            // For now, save to localStorage as fallback
            localStorage.setItem('hitanshHeightsSocietyData', dataString);
        }

        function loadData() {
            const savedData = localStorage.getItem('hitanshHeightsSocietyData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    // Merge with default data structure
                    societyData = { ...societyData, ...parsedData };
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // Auto-save data when changes are made
        function autoSave() {
            saveData();
        }

        // Override data modification functions to include auto-save
        const originalFunctions = {
            addMember: addMember,
            addExpense: addExpense,
            addNotice: addNotice,
            addFine: addFine,
            addVehicle: addVehicle,
            addComplaint: addComplaint,
            uploadDocument: uploadDocument
        };

        // Wrap functions with auto-save
        Object.keys(originalFunctions).forEach(funcName => {
            window[funcName] = function(...args) {
                const result = originalFunctions[funcName].apply(this, args);
                autoSave();
                return result;
            };
        });

        // Load data on startup
        loadData();

        // Export/Import functionality for data backup
        function exportData() {
            const dataString = JSON.stringify(societyData, null, 2);
            const blob = new Blob([dataString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `society_data_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (confirm('This will replace all current data. Are you sure?')) {
                                societyData = importedData;
                                saveData();
                                location.reload(); // Refresh to show imported data
                            }
                        } catch (error) {
                            alert('Error importing data: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // Add backup/restore buttons to admin panel
        function addBackupOptions() {
            if (currentUserType === 'admin') {
                const reportsTab = document.getElementById('reports');
                if (reportsTab && !document.getElementById('backupSection')) {
                    const backupSection = document.createElement('div');
                    backupSection.id = 'backupSection';
                    backupSection.innerHTML = `
                        <h3>Data Management</h3>
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <h3>Export Data</h3>
                                <p>Download complete society data as JSON backup</p>
                                <button class="btn" onclick="exportData()">Export</button>
                            </div>
                            <div class="dashboard-card">
                                <h3>Import Data</h3>
                                <p>Restore society data from JSON backup</p>
                                <button class="btn" onclick="importData()">Import</button>
                            </div>
                        </div>
                    `;
                    reportsTab.appendChild(backupSection);
                }
            }
        }

        // Call addBackupOptions when showing reports tab
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab(tabName);
            if (tabName === 'reports') {
                addBackupOptions();
            }
        };

        // GitHub Pages specific functions
        function setupGitHubIntegration() {
            // This section would contain GitHub API integration
            // For actual deployment, you would need:
            
            /*
            const GITHUB_CONFIG = {
                owner: 'your-username',
                repo: 'society-management',
                token: 'your-github-token', // Use GitHub Actions secrets
                dataPath: 'data/society-data.json'
            };
            
            async function saveToGitHub(data) {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataPath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update society data',
                        content: btoa(JSON.stringify(data, null, 2)),
                        sha: getCurrentFileSha() // Get current file SHA
                    })
                });
                return response.json();
            }
            */
        }

        // Responsive design enhancements
        function handleResponsiveDesign() {
            // Adjust table display on mobile
            function makeTablesResponsive() {
                const tables = document.querySelectorAll('.table');
                tables.forEach(table => {
                    if (window.innerWidth <= 768) {
                        table.style.fontSize = '0.8em';
                        // Hide less important columns on mobile
                        const ths = table.querySelectorAll('th');
                        const tds = table.querySelectorAll('td');
                        
                        if (ths.length > 4) {
                            // Hide middle columns on very small screens
                            for (let i = 2; i < ths.length - 2; i++) {
                                if (ths[i]) ths[i].style.display = 'none';
                            }
                            tds.forEach(td => {
                                if (td.cellIndex >= 2 && td.cellIndex < ths.length - 2) {
                                    td.style.display = 'none';
                                }
                            });
                        }
                    } else {
                        // Show all columns on larger screens
                        table.querySelectorAll('th, td').forEach(cell => {
                            cell.style.display = '';
                        });
                    }
                });
            }

            window.addEventListener('resize', makeTablesResponsive);
            makeTablesResponsive(); // Initial call
        }

        // Initialize responsive design
        handleResponsiveDesign();

        // Print functionality for reports
        function printReport(reportType) {
            const printWindow = window.open('', '_blank');
            let reportData = [];
            let title = '';
            
            switch(reportType) {
                case 'maintenance':
                    title = 'Maintenance Report - Hitansh Heights Society';
                    reportData = societyData.members.map(member => `
                        <tr>
                            <td>${member.flat}</td>
                            <td>${member.name}</td>
                            <td>${member.area}</td>
                            <td>‚Çπ${Math.round(societyData.maintenanceRate * member.area)}</td>
                            <td>${member.maintenancePaid ? 'Paid' : 'Pending'}</td>
                        </tr>
                    `).join('');
                    break;
                // Add other report types similarly
            }
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        h1 { color: #333; text-align: center; }
                        .date { text-align: right; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <div class="date">Generated on: ${new Date().toLocaleDateString()}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Flat No</th>
                                <th>Name</th>
                                <th>Area (sq.ft)</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reportData}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // Add print buttons to reports
        function addPrintButtons() {
            const reportCards = document.querySelectorAll('#reports .dashboard-card');
            reportCards.forEach((card, index) => {
                const reportTypes = ['maintenance', 'expenses', 'fines', 'clubhouse'];
                if (reportTypes[index]) {
                    const printBtn = document.createElement('button');
                    printBtn.className = 'btn';
                    printBtn.textContent = 'Print';
                    printBtn.onclick = () => printReport(reportTypes[index]);
                    card.appendChild(printBtn);
                }
            });
        }

        // Initialize print buttons when reports tab is loaded
        const originalLoadReports = () => addPrintButtons();
        
        // Search and filter functionality
        function addSearchFilters() {
            const searchableItems = ['members', 'expenses', 'fines', 'complaints'];
            
            searchableItems.forEach(item => {
                const tabContent = document.getElementById(item);
                if (tabContent) {
                    const searchDiv = document.createElement('div');
                    searchDiv.className = 'form-group';
                    searchDiv.innerHTML = `
                        <label>Search ${item.charAt(0).toUpperCase() + item.slice(1)}</label>
                        <input type="text" id="${item}Search" placeholder="Search..." onkeyup="filterTable('${item}')">
                    `;
                    
                    // Insert search before the table
                    const table = tabContent.querySelector('.table');
                    if (table) {
                        tabContent.insertBefore(searchDiv, table);
                    }
                }
            });
        }

        function filterTable(tableType) {
            const searchValue = document.getElementById(`${tableType}Search`).value.toLowerCase();
            const table = document.querySelector(`#${tableType} .table tbody`);
            
            if (table) {
                const rows = table.querySelectorAll('tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchValue) ? '' : 'none';
                });
            }
        }

        // Initialize search functionality after page load
        setTimeout(addSearchFilters, 1000);

        console.log('Hitansh Heights Society Management System Loaded Successfully!');
        console.log('Sample Login Credentials:');
        console.log('Admin: username="admin", password="admin123"');
        console.log('Resident: username="A-101" (or any flat number), password="resident123"');
    </script>
</body>
</html>